const urlParams=new URLSearchParams(window.location.search),configFilePath="../js/config.json";let configRespone=await fetch("../js/config.json"),configs=await configRespone.json();const moduleList=configs.moduleList,subPart=configs.subPart,index=urlParams.get("index"),subPartChosen=urlParams.get("subPart"),moduleVer=urlParams.get("mVer");var response,module,isFullTest,moduleCode=configs.moduleCode[index];if(moduleVer>0){let e=`../data/test/${moduleCode}-${moduleVer}.json`;module=await (response=await fetch(e)).json()}else{let t=`../data/test/${moduleCode}.json`;module=await (response=await fetch(t)).json()}var isFullTestRandom=!1,level3Only=0;isFullTest=!(subPartChosen>="0"),document.getElementById("moduleName").innerText=module.ModuleName;var descriptText1=document.getElementById("descriptText1"),QuestionList=module.Questions,CatInfo=module.CatInfos[0],requireLevel=[CatInfo.QuestionRequired[0],CatInfo.QuestionRequired[1],CatInfo.QuestionRequired[2]];let wrongAnswerAllow=.25*(requireLevel[0]+requireLevel[1]+requireLevel[2]);var questionBlock_html=document.getElementById("questionsBlock");document.getElementById("submitButton").onclick=function(){submitTest()},document.getElementById("resetButton").onclick=function(){resetTest()};var currentQuestion=ComputeNewQuestion();function submitTest(){if(!0!=confirm("Bạn muốn nộp b\xe0i?"))return;var e=Math.floor((subPartChosen-1)/subPart[index][moduleVer]*QuestionList.length+1);isFullTest&&(e=1);let t=0;for(let n=0;n<currentQuestion.length;n++){let l="Q"+e.toString();for(var o=document.getElementsByName(l),s=0,r=0;r<o.length;r++)o[r].checked&&(s=r+1);let i=currentQuestion[n].CorrectAnswer;if(s!=i){t++;let u=i-1,a="l"+e.toString()+u.toString();document.getElementById(a).classList.add("wrongAnswer")}e++}descriptText1.innerText=`Bạn đ\xe3 đ\xfang ${currentQuestion.length-t}/${currentQuestion.length} c\xe2u.`,isFullTest&&(t<=wrongAnswerAllow?descriptText1.innerText+=" Bạn đ\xe3 đạt b\xe0i thi.":descriptText1.innerText+=" Bạn chưa đạt b\xe0i thi."),window.scrollTo(0,0)}function resetTest(){!0==confirm("Bạn muốn l\xe0m b\xe0i test mới?")&&(currentQuestion=ComputeNewQuestion(),DisplayQuestion())}function ComputeNewQuestion(){var e=[];if(isFullTest){var t=[];for(let n=0;n<QuestionList.length;n++)t.push(n);for(let l=0;l<16;l++){let o=Math.floor(Math.random()*t.length);e.push(QuestionList[o]),t.splice(o,1)}descriptText1.innerText=`Số c\xe2u hỏi: ${e.length} c\xe2u. Bạn cần đ\xfang ${.75*e.length} c\xe2u.`}else{var s=subPart[index][moduleVer],r=Math.floor((subPartChosen-1)/s*QuestionList.length),i=Math.floor(subPartChosen/s*QuestionList.length);if((e=QuestionList.slice(r,i)).forEach(e=>{e=SwapAnswer(e)}),-1==level3Only)for(var u=0;u<e.length;u++)3==e[u].Level&&(e.splice(u,1),u--);else if(1==level3Only)for(var u=0;u<e.length;u++)3!=e[u].Level&&(e.splice(u,1),u--);descriptText1.innerText=`Số c\xe2u hỏi: ${e.length}. C\xe2u hỏi ${r+1} - ${i}.`}return isFullTestRandom&&shuffle(e),e}function DisplayQuestion(){questionBlock_html.innerHTML="";var e=Math.floor((subPartChosen-1)/subPart[index][moduleVer]*QuestionList.length+1);isFullTest&&(e=1);for(var t=0;t<currentQuestion.length;t++){let n=document.createElement("form");var l=document.createElement("p");l.className="questionString",l.innerText="C\xe2u "+e.toString()+": "+currentQuestion[t].QuestionString,questionBlock_html.appendChild(l);for(let o=0;o<3;o++){let s=document.createElement("input");s.type="radio";let r="q"+e.toString()+o.toString(),i="Q"+e.toString();s.id=r,s.value=o+1,s.name=i,n.append(s);let u=document.createElement("label");u.innerText=currentQuestion[t].Answers[o],u.htmlFor=r;let a="l"+e.toString()+o.toString();u.id=a,u.classList.add("answerString"),n.append(u),n.append(document.createElement("br"))}e++,questionBlock_html.append(n)}}function AddRandomButton(){if(!isFullTest){var e=document.getElementById("buttonHeaderDiv"),t=document.createElement("button");t.id="randomStateButton",!1==isFullTestRandom?t.innerText="X\xe1o trộn c\xe2u hỏi: Tắt":t.innerText="X\xe1o trộn c\xe2u hỏi: Bật",t.classList.add("button"),t.onclick=changeRandomState,e.append(t)}}function AddRemoveLevel3Button(){if(!isFullTest){var e=document.getElementById("buttonHeaderDiv"),t=document.createElement("button");t.id="level3StateButton",t.classList.add("button"),t.onclick=changeLevel3State,e.append(t),setLevel3ButtonText()}}function SwapAnswer(e){let t=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],n=Math.floor(6*Math.random()),l=[],o;for(let s=0;s<3;s++)l.push(e.Answers[t[n][s]]),t[n][s]+1==e.CorrectAnswer&&(o=s+1);return e.Answers=l,e.CorrectAnswer=o,e}function shuffle(e){var t,n,l;for(l=e.length-1;l>0;l--)t=Math.floor(Math.random()*(l+1)),n=e[l],e[l]=e[t],e[t]=n;return e}function changeRandomState(){isFullTestRandom=!isFullTestRandom;var e=document.getElementById("randomStateButton");!1==isFullTestRandom?e.innerText="X\xe1o trộn c\xe2u hỏi: Tắt":e.innerText="X\xe1o trộn c\xe2u hỏi: Bật"}function setLevel3ButtonText(){var e=document.getElementById("level3StateButton");0==level3Only?e.innerText="Giữ level 3":-1==level3Only?e.innerText="Bỏ level 3":1==level3Only&&(e.innerText="Chỉ c\xf2n level 3")}function changeLevel3State(){level3Only=0==level3Only?-1:-1==level3Only?1:0,setLevel3ButtonText()}AddRandomButton(),AddRemoveLevel3Button(),DisplayQuestion();
